
	<script src='https://code.responsivevoice.org/responsivevoice.js'></script>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<meta charset="UTF-8">
	<title>Live Chat</title>
	<
	<style type="text/css">
		@charset "utf-8";
/* CSS Document */

/* ---------- GENERAL ---------- */
.speech {border: 1px solid #DDD; width: 300px; padding: 0; margin: 0}
  .speech input {border: 0; width: 240px; display: inline-block; height: 30px;}
  .speech img {float: right; width: 40px }

  .mihir{
		border-radius: 2px green solid;
		background-color: green;
		color:white;
		border-color: green;
		height:35px;
		width:150px;
		margin-bottom:30px;
		box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);

		margin-left:50%;
	}
	.mihir:hover{
		border-radius: 2px green solid;
		background-color: white;
		color:green;
		border-color: green;
		height:35px;
		width:150px;
		margin-bottom:30px;
		box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);

		margin-left:50%;
	}




p { margin-top: -40p; 
		color:green;}


body {
  background: #e9e9e9;
  color: #9a9a9a;
  font: 100%/1.5em "Droid Sans", sans-serif;
  margin: 0;
}

a { text-decoration: none; }

fieldset {
  border: 0;
  margin: 0;
  padding: 0;
}

h4, h5 {
  line-height: 1.5em;
  margin: 0;
}

hr {
  background: #e9e9e9;
    border: 0;
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 1px;
    margin: 0;
    min-height: 1px;
}

img {
    border: 0;
    display: block;
    height: auto;
    max-width: 100%;
}

input {
  border: 0;
  color: inherit;
    font-family: inherit;
    font-size: 100%;
    line-height: normal;
    margin: 0;
}

p { margin: 0; }

.clearfix { *zoom: 1; } /* For IE 6/7 */
.clearfix:before, .clearfix:after {
    content: "";
    display: table;
}
.clearfix:after { clear: both; }

/* ---------- LIVE-CHAT ---------- */

#live-chat {
  bottom: 0;
  font-size: 12px;
  right: 24px;
  position: fixed;
  width: 500px;
}

#live-chat header {
  background: #293239;
  border-radius: 5px 5px 0 0;
  color: #fff;
  cursor: pointer;
  padding: 16px 24px;
}

#live-chat h4:before {
  background: #1a8a34;
  border-radius: 50%;
  content: "";
  display: inline-block;
  height: 8px;
  margin: 0 8px 0 0;
  width: 8px;
}

#live-chat h4 {
  font-size: 12px;
}

#live-chat h5 {
  font-size: 10px;
}

#live-chat form {
  padding: 24px;
}

#live-chat input[type="text"] {
  border: 1px solid #ccc;
  border-radius: 3px;
  padding: 8px;
  outline: none;
  width: 234px;
}

.chat-message-counter {
  background: #e62727;
  border: 1px solid #fff;
  border-radius: 50%;
  display: none;
  font-size: 12px;
  font-weight: bold;
  height: 28px;
  left: 0;
  line-height: 28px;
  margin: -15px 0 0 -15px;
  position: absolute;
  text-align: center;
  top: 0;
  width: 28px;
}

.chat-close {
  background: #1b2126;
  border-radius: 50%;
  color: #fff;
  display: block;
  float: right;
  font-size: 10px;
  height: 16px;
  line-height: 16px;
  margin: 2px 0 0 0;
  text-align: center;
  width: 16px;
}

.chat {
  background: #fff;
}

.chat-history {
  height: 252px;
  padding: 8px 24px;
  overflow-y: scroll;
}

.chat-message {
  margin: 16px 0;
}

.chat-message img {
  border-radius: 50%;
  float: left;
}

.chat-message-content {
  margin-left: 56px;
}

.chat-time {
  float: right;
  font-size: 10px;
}

.chat-feedback {
  font-style: italic; 
  margin: 0 0 0 80px;
}
	</style>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700">

</head>
<body>
	
	<script src="http://localhost:4000/socket.io/socket.io.js"></script>

	<div id="live-chat">
		
		<header class="clearfix">
			
			<a href="#" class="chat-close">x</a>

			<h4>Agriculture Bot</h4>

			<span class="chat-message-counter">Ask</span>

		</header>

		<div class="chat">
			
			<div class="chat-history">
			

				<div class="chat-message clearfix">
					
					<img src="https://image.freepik.com/free-photo/robot-doing-the-peace-sign_1048-3527.jpg" alt="" width="32" height="32">

					<div class="chat-message-content clearfix">
						
						<span class="chat-time"></span>

						<h5>AgriBot</h5>

						<p>What can I do for you today ?</p>

					</div> <!-- end chat-message-content -->

				</div> <!-- end chat-message -->

				<hr>

			</div> <!-- end chat-history -->

			

			<form id="myForm">

				<fieldset>
					
					<input id="message" type="text" placeholder="Type your messageâ€¦" autofocus>
					<img onclick="startDictation()" src="https://d2llddowri9p3s.cloudfront.net/media/catalog/product/cache/18/image/850x680/9df78eab33525d08d6e5fb8d27136e95/s/t/streammic_c_2.png" style="height: 30px;width: 30px;float:right; " />
					<input type="hidden">
					
				</fieldset>

			</form>

		</div> <!-- end chat -->

	</div> <!-- end live-chat -->

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
	<script type="text/javascript">
		(function() {

	$('#live-chat header').on('click', function() {

		$('.chat').slideToggle(300, 'swing');
		$('.chat-message-counter').fadeToggle(300, 'swing');

	});

	$('.chat-close').on('click', function(e) {

		e.preventDefault();
		$('#live-chat').fadeOut(300);

	});

}) ();
	</script>

	
	<script type="text/javascript">

		var host = 'localhost';
		var nodejs_port = '4000';
		var socket = io(host + ':' + nodejs_port);


		$('form').submit(function(){
			console.log("submit..");
			var query = $('#message');

			var time = $('<span class="chat-time"></span>').append(formatAMPM(new Date()));
			var username = $('<h5></h5>').append(String( "{{customer.F}}" ))
			var content = $('<p></p>').append(query.val().trim());
			var image = $('<img style="margin-left:-55px;border-radius:50%;" src="{{customer.image.url}}"  width="32" height="32">');

			var chatMessageContent = $('<div class="chat-message-content clearfix;" style="color:red;">').append(image,time,username,content,"<hr><br>");
			$('.chat-history').append(chatMessageContent);
			

			if(query.val().trim() !== "" ){
				queryObject = { 'query' :query.val().trim() };
				socket.emit('wikisearch',queryObject);
				return false;
			} 
			
			return false;
		});

		socket.on('results',function(result){

			if ( result.value == "error" ){
				var time = $('<span class="chat-time"></span>').append(formatAMPM(new Date()));
				var username = $('<h5></h5>').append(String( "AgriBot" ))
				var content = $('<p></p>').append("Sorry ! I could not find anything");
				var image = $("<img style='margin-left:-55px;border-radius:50%' src='https://image.freepik.com/free-photo/robot-doing-the-peace-sign_1048-3527.jpg' alt='' width='32' height='32'>");


				var video = $('<iframe id="demo" width="420" height="345"></iframe>');
				video.attr("src",function(){
					return "https://www.youtube.com/embed/"+ youtube_parser(result.url);

					function youtube_parser(url){
						var regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;
						var match = url.match(regExp);
						return (match&&match[7].length==11)? match[7] : false;
					}
				});


				var chatMessageContent = $('<div class="chat-message-content clearfix">').append(image,time,username,content,"<hr><br>");
				$('.chat-history').append(chatMessageContent,video);
				
				
			}
			else{
				var time = $('<span class="chat-time"></span>').append(formatAMPM(new Date()));
				var username = $('<h5></h5>').append(String( "AgriBot" ))
				var content = $('<p></p>').append(result.english);
				var image = $("<img style='margin-left:-55px;border-radius:50%' src='https://image.freepik.com/free-photo/robot-doing-the-peace-sign_1048-3527.jpg' alt='' width='32' height='32'>");
				var hindi = result.hindi;
				
				console.log(hindi);
				
				var video = $('<iframe id="demo" width="420" height="345"></iframe>');
				video.attr("src",function(){
					return "https://www.youtube.com/embed/"+ youtube_parser(result.url);

					function youtube_parser(url){
						var regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;
						var match = url.match(regExp);
						return (match&&match[7].length==11)? match[7] : false;
					}
				});

				var voice = $('<input class="mihir" type="button" value="Read the Description !"></input>');
				voice.click(function(){
					if(responsiveVoice.isPlaying()) {
						responsiveVoice.pause();
					}
					else{
						responsiveVoice.speak( hindi ,"Hindi Female");
					}
				});
				var chatMessageContent = $('<div class="chat-message-content clearfix">').append(image,time,username,content,"<hr><br>");
				$('.chat-history').append(chatMessageContent,voice,video);
				
				

			}
			
		});

		$('.chat-time').text(formatAMPM(new Date()));
		function formatAMPM(date) {
			var hours = date.getHours();
			var minutes = date.getMinutes();
			var ampm = hours >= 12 ? 'pm' : 'am';
			hours = hours % 12;
		  hours = hours ? hours : 12; // the hour '0' should be '12'
		  minutes = minutes < 10 ? '0'+minutes : minutes;
		  var strTime = hours + ':' + minutes + ' ' + ampm;
		  return strTime;
		}

	</script>
	<script>
  function startDictation() {

    if (window.hasOwnProperty('webkitSpeechRecognition')) {

      var recognition = new webkitSpeechRecognition();

      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.lang = "en-US";
      recognition.start();

      recognition.onresult = function(e) {
        document.getElementById('message').value
                                 = e.results[0][0].transcript;
        recognition.stop();
        
			console.log("submit..");
			var query = $('#message');

			var time = $('<span class="chat-time"></span>').append(formatAMPM(new Date()));
			var username = $('<h5></h5>').append(String( "{{customer.F}}" ))
			var content = $('<p></p>').append(query.val().trim());
			var image = $('<img style="margin-left:-55px;border-radius:50%;" src="{{customer.image.url}}"  width="32" height="32">');

			var chatMessageContent = $('<div class="chat-message-content clearfix;" style="color:red;">').append(image,time,username,content,"<hr><br>");
			$('.chat-history').append(chatMessageContent);
			

			if(query.val().trim() !== "" ){
				queryObject = { 'query' :query.val().trim() };
				socket.emit('wikisearch',queryObject);
				return false;
			} 
			
			
      };

      recognition.onerror = function(e) {
        recognition.stop();

      }

    }
  }
</script>

</body>
</html>